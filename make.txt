virtualenv venv --clear
venv\scripts\activate.bat

pip install -U -r requirements.txt
pip install -U pyinstaller-5.0.dev0-py3-none-any.whl
pip cache purge

rem 7z x Cython-0.29.24.tar
rem cd Cython-0.29.24
rem pip install .
rem rm -r Cython-0.29.24
rem cd ..

pip install cython

cd src
python setup.py build_ext --inplace
cd ..

pause

set Excludes=--exclude _asyncio --exclude _bz2 --exclude _decimal --exclude _hashlib --exclude _lzma --exclude _multiprocessing --exclude _overlapped --exclude _queue --exclude pyexpat --exclude lib2to3 --exclude xml --exclude difflib --exclude distutils --exclude sysconfig --exclude pickle
set Resources=--additional-hooks-dir utils
set Icons=--icon "src/res/riva.ico"

pyinstaller -y --clean --log-level=DEBUG -n "spambotcli" src/cli.py --version-file "src/metadata/cli.version" %Excludes% %Resources% %Icons%
pyinstaller -y --clean --log-level=DEBUG -n "spambotcli" src/cli.py --version-file "src/metadata/cli.version" %Excludes% %Resources% %Icons% --onefile

pyinstaller -y --clean --log-level=DEBUG -n "spambotgui" src/gui.py --version-file "src/metadata/gui.version" -w %Excludes% %Resources% %Icons%
pyinstaller -y --clean --log-level=DEBUG -n "spambotgui" src/gui.py --version-file "src/metadata/gui.version" -w %Excludes% %Resources% %Icons% --onefile

rm *.spec
rm -r build

cd utils
gcc -Wall -Wextra -pipe -s -Os -flto --no-ident rickroll.c -o rickroll.exe
